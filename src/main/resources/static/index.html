<html>
  <head>
    <style type="text/css">
      .modal {
      	display: none;
      	position: fixed;
      	z-index: 1;
      	left: 0;
      	top: 0;
      	width: 100%;
      	height: 100%;
      	overflow: auto;
      	background-color: rgb(0, 0, 0);
      	background-color: rgba(0, 0, 0, 0.4);
      }
      
      .modal-content {
      	background-color: #fefefe;
      	margin: 15% auto;
      	padding: 20px;
      	border: 1px solid #888;
      	width: 80%;
      }
    </style>
    <script type="text/javascript">
      var client = new XMLHttpRequest();
      client.onerror = function(e) {
        alert("Error: " + e.error);
      };
      client.onload = function() {
        if (!this.response) return;
        var resp = JSON.parse(this.response);
        if (resp.status / 100 != 2) {
          alert(resp.path + ": " + resp.status + " " + resp.error);
        }
      };
    
      function elt(id) {
        return document.getElementById(id);
      }
    
      function val(id) {
        return elt(id).value;
      }
    
      function setStyle(element, visibility, display) {
        element.style.visibility = visibility;
        element.style.display = display;
      }
    
      function show(id) {
        setStyle(elt(id), "visible", "block");
      }
    
      function hide(id) {
        setStyle(elt(id), "hidden", "none");
      }
    
      function modalDialog(question, defaultAnswer, handleOk) {
        elt("question").textContent = question;
        elt("answer").value = defaultAnswer;
        elt("ok").onclick = function() {
          var answer = elt("answer").value;
          hide("modalDialog");
          handleOk(answer);
        }
        show("modalDialog");
        elt("answer").focus();
      }
    
      function cancel() {
        hide("modalDialog");
      }
    
      function fileNameFrom(baseName) {
        return baseName.toLowerCase().replace(/\s+/g, "-") + ".txt"
      }
    
      function save() {
        var title = val("title");
        var text = val("text");
        modalDialog("Save as", fileNameFrom(title), function(fileName) {
          var payload = JSON.stringify({
            "fileName" : fileName,
            "text" : text
          });
          client.open("POST", "/work");
          client.setRequestHeader("Content-Type", "application/json");
          client.send(payload);
          elt("text").focus();
        });
      }
    
      function ensureText(field) {
        if (!field.value) {
          field.value = 'Enter text'
          field.select()
        }
      }
    
      function init() {
        elt("title").focus();
      }
    </script>
  </head>
  <body onload="init()">
    <div id="">
      <h3>
        Write your <em>Heartbreaking Work of Staggering Genius</em>!
      </h3>
      <p>
        <label for="title">Title:</label><br />
        <input id="title" type="text" value="Enter text" oninput="ensureText(this)" />
      </p>
      <p>
        <label for="text">Contents:</label><br />
        <textarea id="text" cols="80" rows="14" oninput="ensureText(this)">Enter text</textarea>
      </p>
      <p>
        <a id="save" href="javascript:save()">Save</a>
      </p>
    </div>
    <div id="modalDialog" class="modal">
      <div id="modalDialogContent" class="modal-content">
        <p>
          <label id="question" for="answer"></label>&nbsp;<input id="answer" type="text" />
        </p>
        <p>
          <input id="ok" type="submit" value="OK" />&nbsp;<input type="submit" value="Cancel" onclick="cancel()" />
        </p>
      </div>
    </div>
  </body>
</html>
